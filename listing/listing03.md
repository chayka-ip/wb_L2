Что выведет программа? Объяснить вывод программы. Объяснить внутреннее устройство интерфейсов и их отличие от пустых интерфейсов.

```go
package main

import (
	"fmt"
	"os"
)

func Foo() error {
	var err *os.PathError = nil
	return err
}

func main() {
	err := Foo()
	fmt.Println(err)
	fmt.Println(err == nil)
}
```

Ответ:
```
<nil>
false
```
- error является интерфейсным типом. Интерфейсный тип содержит в себе конкретное значение и дескриптор типа. В функции ```Foo()``` переменной err присваивается нулевой указатель на тип ```os.PathError```. При этом значение  в интерфейсном типе станет равным nil, но дескриптором этого значения будет ```*os.PathError```.
- Функция ```fmt.Println()``` по умолчанию выведет конкретное значение переданной переменной. Так как это значение переменной err равно ```nil```, в консоль будет выведено ```nil```.
- Переменная интерфейсного типа будет равна ```nil``` лишь в том случае, когда и конкретное значение и дескриптор типа будут равны ```nil```. Этим обьясняется получение ```false``` при сравнении в выражении  ```err == nil```.
  
---
Внутреннее устройство интерфейса выглядит так:

```go
type iface struct { // 16 bytes on a 64bit arch
    tab  *itab
    data unsafe.Pointer
}
```
Данная структура содержит два указателя:
- ```tab``` - указатель на структуру, содержащую информацию, которая описывает тип самого интерфейса и тип динамического значения. 
- ```data``` - указатель на динамическое значение, хранящееся в интерфейсе.

Устройство ```itab```:

```go
type itab struct { // 40 bytes on a 64bit arch
    inter *interfacetype
    _type *_type
    hash  uint32 // copy of _type.hash. Used for type switches.
    _     [4]byte
    fun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.
}
```
- ```inter```является указателем на ```interfacetype```, который описывает тип самого интерфейса и содержит в себе указатель на ```_type``` и некоторую дополнительную информацию, присущую самим интерфейсам. В нынешней реализации к ним относятся: путь к пакету, где обьявлен интерфейс и список оффсетов, указывающих на соотвествующие имена и типы методов, предоставляемых интерфейсом.
```go
type interfacetype struct { // 80 bytes on a 64bit arch
    typ     _type
    pkgpath name
    mhdr    []imethod
}

type imethod struct {
    name nameOff
    ityp typeOff
}
```

- ```_type``` является внутренним представлением любого типа Go во время выполнения. Здесь описаны все аспекты типа, а именно: имя типа, характеристики (размер, выравнивание и тд), некоторая информация о хешировании типа, поведение при сравнении и тд. В ```itab``` поле ```_type```  описывает тип того значения, которое хранится в интерфейсе (динамическое значение).
```go
type _type struct { // 48 bytes on a 64bit arch
    size       uintptr
    ptrdata    uintptr // size of memory prefix holding all pointers
    hash       uint32
    tflag      tflag
    align      uint8
    fieldalign uint8
    kind       uint8
    alg        *typeAlg
    // gcdata stores the GC type data for the garbage collector.
    // If the KindGCProg bit is set in kind, gcdata is a GC program.
    // Otherwise it is a ptrmask bitmap. See mbitmap.go for details.
    gcdata    *byte
    str       nameOff
    ptrToThis typeOff
}
```
- ```fun``` содержит указатели на функции, присущие данному интерфейсу. Компилятор не учитывает обьявляемый размер этого массива, так как он сам вычислит количество необходимой памяти. Данные из массива извлекаются с применением ```unsafe.Pointer```, поэтому проверка размера массива не производится.
- ```itab``` вычисляется во время выполнения при первой необходимости путем поиска методов интерфейса в таблице методов статического типа. Если статический тип реализует все методы из таблицы методов интерфейса, то он реализует данный интефрейс. В таком случае результат вычисления кешируется и переиспользуется далее в ходе выполнения программы. 

---
Пустой интерфейс имеет следующую структуру:
```go
type eface struct {
	_type *_type
	data  unsafe.Pointer
}
```
Пустой интерфейс состоит из двух указателей:
- ```_type``` - указатель на тип динамического значения, храняещегося в интерфейсе.
- ```data``` - указатель на динамическое значение, хранящееся в интерфейсе.
- Пустой интерфейс не реализует никаких методов. Из этого следует, что тип пустого интерфейса всегда один и тот же вне зависимости от типа хранящихся в нем данных.
- Хотя пустой интерфейс мог бы быть реализован с использованием стуктуры ```iface```, для него была создана отдельная структура в целях оптимизации.